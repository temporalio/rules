# TMPRL1100 - Non-determinism detected during workflow replay

## Cause

During workflow replay, the workflow code took a different path than it did when the workflow originally ran.

## Description

A non-determinism error occurs if, during workflow replay, the system determines a different set of commands was
generated by the workflow code than is expected based on the events from the last code run. A workflow replay occurs
when the workflow history is manually run in a replayer or when a worker needs to resume a workflow that is no longer
cached (e.g. on worker crash or workflow cache eviction).

This usually happens in one of two cases: there is non-deterministic code causing a different path to be traversed, or
a code change happened that took a different path for past workflow code.

This is explained in depth in the
[determinism section of the documentation](https://docs.temporal.io/workflow-definition#deterministic-constraints).

## Remediations

Often it is best to try to replicate this by downloading the history of the offending workflow and running it through
the replayer. See the [documentation for replayers](https://docs.temporal.io/workflows#replays). When running via the
replayer, code can be debugged to see why it may have taken a different path.

Once it is determined why the code is taking a different path, several options are available:

### Patching

If the non-determinism error is due to new code being introduced, the code can be changed to only _patch_ in the new
changes allowing past executions to not be affected by them. See the
[patching documentation](https://docs.temporal.io/workflows#patching).

### Versioning

If the non-determinism error is due to new code being introduced, the worker with the new code can be versioned so that
older workflows run on older versions. See the
[versioning documentation](https://docs.temporal.io/workers#worker-versioning).

### Fix code (and maybe reset)

If the non-determinism error is due to accidental non-deterministic code in the workflow, often a simple deployed code
fix can automatically fix it. In cases where it can't simply be fixed, workflows can be reset to previous points in
history to execute the code again this time using proper code. Note, of course, that this means potentially re-running
things that have already executed before. See the [reset documentation](https://docs.temporal.io/workflows#reset).